% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/tbl_now.R
\name{tbl_now}
\alias{tbl_now}
\title{Create a `tbl_now` object}
\usage{
tbl_now(
  data,
  event_date,
  report_date,
  strata = NULL,
  covariates = NULL,
  is_batched = NULL,
  now = NULL,
  event_units = "auto",
  report_units = "auto",
  data_type = "auto",
  case_col = NULL,
  verbose = TRUE,
  force = FALSE,
  ...
)
}
\arguments{
\item{data}{A `data.frame` to be converted.}

\item{event_date}{Character. The name of the column containing the event date.}

\item{report_date}{Character. The name of the column containing the report date.}

\item{strata}{(optional) Character vector or `NULL` (default). Name of different variables
(column names) in strata. Strata correspond to variables that are of interest
by themselves. For example if it is of interest to generate nowcasts by gender then
`gender` is a `strata`.}

\item{covariates}{(optional) Character vector or `NULL` (default). Name of different variables
(column names) that influence the nowcast but are not strata.
For example precipitation might influence a dengue nowcast but in general it
is not of interest to generate nowcasts by precipitation levels.}

\item{is_batched}{(optional) Character or `NULL` (default). The name of a column containing either
`TRUE` or `FALSE` indicating whether the `report_date` is correctly specified
or corresponds to a `batch` and thus is censored. In other words, if the
`report_date` is accurately measured set `report_date = TRUE` but if
the `report_date` corresponds to an error and is only an upper bound of
the real, idealized, report date set `is_batched = TRUE`.}

\item{now}{(optional) Date or `NULL` (default). The date that is considered the `now` of the
nowcast. If no `now` is given then the function automatically uses the last
`event_date`.}

\item{event_units}{(optional) Character. Either "auto" (default), "days",
"weeks", "months", "years" or "numeric".}

\item{report_units}{(optional) Character. Either "auto" (default), "days",
"weeks", "months", "years" or "numeric".}

\item{data_type}{(optional) Character. Either "auto", "linelist" or
"count".}

\item{case_col}{(optional) Name of the column with the case counts if
`data_type` is "count". If `case_col` is specified even if `data_type`
is "linelist" that name will be used if the `to_count` function is applied.}

\item{verbose}{(optional) Logical. Whether to throw a message. Default = `TRUE`.}

\item{force}{(optional) Logical. Whether to force computation overwriting pre-existing variables.
Default = `FALSE`.}

\item{...}{Additional metadata to be stored as attributes.}
}
\value{
An object of class `tbl_now`.
}
\description{
A special `data.frame` class that includes information for the nowcast.
See the Attributes section for more information.
}
\section{Attributes}{


The following attributes are part of a `tbl_now` and are validated
by the [validate_tbl_now()] function:

\describe{
  \item{event_date}{Name of the column refering to the event of interest.}
  \item{report_date}{Name of the column refering to when the event of interest was reported.}
  \item{strata}{Names of the columns corresponding to the strata (for modelling).}
  \item{num_strata}{Number of strata. Corresponds to `length(strata)`.}
  \item{covariates}{Names of the columns corresponding to covariates (for modelling).}
  \item{num_covariates}{Number of covariates Corresponds to `length(covariates)`.}
  \item{now}{Date of the `now` for a nowcast.}
  \item{is_batched}{Column indicating whether the measurement is noisy (only upper bound) or not.}
  \item{event_units}{Either `days`, `weeks`, `months`, `years` or `numeric`. Corresponds to the units of `event_date`}
  \item{report_units}{Either `days`, `weeks`, `months`, `years` or `numeric`. Corresponds to the units of `report_date`}
  \item{repot_num}{Column where the `report_date` was transformed to numeric values}
  \item{event_num}{Column where the `event_date` was transformed to numeric values}
  \item{data_type}{Either `linelist` or `count` depending on whether it is linelist data
  or count data}
}
}

\examples{
# The `tbl_now` is a data.frame with additional attributes
data(denguedat)
ndata <- tbl_now(denguedat,
    event_date = "onset_week",
    report_date = "report_week",
    strata = "gender")

# You can see that it documents the `event_date`, `report_date`, `strata`,
# `covariates` as well as the `now`.
ndata


#A `tbl_now` is an extension of a `tibble` which means normal
#`data.frame` operations are permitted
ndata$newcolumn <- "something"
ndata

#Like removing a column
ndata <- ndata[,-4]
ndata

#Like selecting
ndata[1:10,]
ndata

#You can also apply all dplyr functions:
ndata \%>\%
  dplyr::filter(report_week <= as.Date("1991-01-02", format = "\%Y-\%m-\%d"))

#Removing an important column automatically transforms to tibble
#losing its property
suppressWarnings(
  ndata \%>\%
    dplyr::select(-onset_week)
)

#Removing strata just changes the overall structure
ndata \%>\% dplyr::select(-gender)

}
